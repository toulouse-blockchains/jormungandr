<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Jormungandr</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="introduction.html">Introduction</a></li><li><a href="concepts/introduction.html"><strong aria-hidden="true">1.</strong> General Concepts</a></li><li><ol class="section"><li><a href="concepts/blockchain.html"><strong aria-hidden="true">1.1.</strong> Blockchain concepts</a></li><li><a href="concepts/stake.html"><strong aria-hidden="true">1.2.</strong> Stake</a></li><li><a href="concepts/node.html"><strong aria-hidden="true">1.3.</strong> Node organisation</a></li></ol></li><li><a href="quickstart/introduction.html"><strong aria-hidden="true">2.</strong> Quickstart</a></li><li><ol class="section"><li><a href="quickstart/01_command_line.html"><strong aria-hidden="true">2.1.</strong> Command lines tools</a></li><li><a href="quickstart/02_passive_node.html"><strong aria-hidden="true">2.2.</strong> Starting a passive node</a></li><li><a href="quickstart/03_rest_api.html"><strong aria-hidden="true">2.3.</strong> REST API</a></li><li><a href="quickstart/04_leader_candidate.html"><strong aria-hidden="true">2.4.</strong> Starting as a leader candidate</a></li></ol></li><li><a href="configuration/introduction.html"><strong aria-hidden="true">3.</strong> Configuration</a></li><li><ol class="section"><li><a href="configuration/logging.html"><strong aria-hidden="true">3.1.</strong> Logging</a></li><li><a href="configuration/network.html"><strong aria-hidden="true">3.2.</strong> Node network</a></li></ol></li><li><a href="jcli/introduction.html"><strong aria-hidden="true">4.</strong> jcli</a></li><li><ol class="section"><li><a href="jcli/key.html"><strong aria-hidden="true">4.1.</strong> Cryptographic keys</a></li><li><a href="jcli/address.html"><strong aria-hidden="true">4.2.</strong> Address</a></li><li><a href="jcli/transaction.html"><strong aria-hidden="true">4.3.</strong> Transaction</a></li><li><a href="jcli/certificate.html"><strong aria-hidden="true">4.4.</strong> Certificate</a></li><li><a href="jcli/genesis.html"><strong aria-hidden="true">4.5.</strong> Genesis</a></li><li><a href="jcli/rest.html"><strong aria-hidden="true">4.6.</strong> REST</a></li></ol></li><li><a href="stake_pool/introduction.html"><strong aria-hidden="true">5.</strong> staking and stake pool</a></li><li><ol class="section"><li><a href="stake_pool/delegating_stake.html"><strong aria-hidden="true">5.1.</strong> delegating your stake</a></li><li><a href="stake_pool/registering_stake_pool.html"><strong aria-hidden="true">5.2.</strong> registering stake pool</a></li></ol></li><li><a href="advanced/introduction.html"><strong aria-hidden="true">6.</strong> Advanced</a></li><li><ol class="section"><li><a href="advanced/01_the_genesis_block.html"><strong aria-hidden="true">6.1.</strong> Genesis block</a></li><li><a href="advanced/02_starting_bft_blockchain.html"><strong aria-hidden="true">6.2.</strong> Starting a bft blockchain</a></li><li><a href="advanced/03_starting_genesis_praos_blockchain.html"><strong aria-hidden="true">6.3.</strong> Starting a genesis blockchain</a></li></ol></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Jormungandr</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#jormungandr-user-guide" id="jormungandr-user-guide"><h1>Jormungandr User Guide</h1></a>
<p>Welcome to the Jormungandr User Guide.</p>
<p>Jormungandr is a node implementation, written in rust, with the
initial aim to support the Ouroboros type of consensus protocol.</p>
<p>A node is a participant of a blockchain network, continuously making,
sending, receiving, and validating blocks. Each node is responsible
to make sure that all the rules of the protocol are followed.</p>
<a class="header" href="#mythology" id="mythology"><h2>Mythology</h2></a>
<p>Jörmungandr refers to the <em>Midgard Serpent</em> in Norse mythology. It is a hint to
<em>Ouroboros</em>, the Ancient Egyptian serpent, who eat its own tail, as well as the
<a href="https://eprint.iacr.org/2016/889.pdf">IOHK paper</a> on proof of stake.</p>
<a class="header" href="#general-concepts" id="general-concepts"><h1>General Concepts</h1></a>
<p>This chapter covers the general concepts of the blockchain, and their application
in the node, and is followed by the node organisation and the user interaction with it.</p>
<a class="header" href="#blockchain-concepts" id="blockchain-concepts"><h1>Blockchain concepts</h1></a>
<a class="header" href="#time" id="time"><h2>Time</h2></a>
<p>Slots represent the basic unit of time in the blockchain, and at each slot
a block could be present.</p>
<p>Consecutive slots are grouped into epochs, which have updatable size defined
by the protocol.</p>
<a class="header" href="#fragments" id="fragments"><h2>Fragments</h2></a>
<p>Fragments are part of the blockchain data that represent all the possible
events related to the blockchain health (e.g. update to the protocol), but
also and mainly the general recording of information like transactions and
certificates.</p>
<a class="header" href="#blocks" id="blocks"><h2>Blocks</h2></a>
<p>Blocks represent the spine of the blockchain, safely and securely linking
blocks in a chain, whilst grouping valid fragments together.</p>
<p>Blocks are composed of 2 parts:</p>
<ul>
<li>The header</li>
<li>The content</li>
</ul>
<p>The header link the content with the blocks securely together, while the
content is effectively a sequence of fragments.</p>
<a class="header" href="#blockchain" id="blockchain"><h2>Blockchain</h2></a>
<p>The blockchain is the general set of rules and the blocks that are periodically created.
Some of the rules and settings, can be changed dynamically in the system by updates,
while some other are hardcoded in the genesis block (first block of the blockchain).</p>
<pre><code>    +-------+      +-------+
    |Genesis+&lt;-----+Block 1+&lt;--- ....
    |Header |      |Header |
    +---+---+      +---+---+
        |              |
    +---v---+      +---v---+
    |Genesis|      |Block 1|
    |Content|      |Content|
    +-------+      +-------+
</code></pre>
<a class="header" href="#consensus" id="consensus"><h2>Consensus</h2></a>
<p>The node currently support the following consensus protocol:</p>
<ul>
<li>Ouroboros BFT (OBFT)</li>
<li>Ouroboros Genesis-Praos</li>
</ul>
<p>Ouroboros BFT is a simple Byzantine Fault Tolerant (BFT) protocol where the
block makers is a known list of leaders that successively create a block and
broadcast it on the network.</p>
<p>Ouroboros Genesis Praos is a proof of stake (PoS) protocol where the block
maker is made of a lottery where each stake pool has a chance proportional to
their stake to be elected to create a block. Each lottery draw is private to
each stake pool, so that the overall network doesn't know in advance who can
or cannot create blocks.</p>
<p>In Genesis-Praos slot time duration is constant, however the frequency of
creating blocks is not stable, since the creation of blocks is a probability
that is linked to the stake and active slot coefficient.</p>
<a class="header" href="#leadership" id="leadership"><h2>Leadership</h2></a>
<p>The leadership represent in abstract term, who are the overall leaders of the
system and allow each individual node to check that specific blocks are
lawfully created in the system.</p>
<p>The leadership is re-evaluated at each new epoch and is constant for the
duration of an epoch.</p>
<a class="header" href="#leader" id="leader"><h2>Leader</h2></a>
<p>Leader are an abstration related to the specific actor that have the ability
to create block; In OBFT mode, the leader just the owner of a cryptographic
key, whereas in GenesisPraos mode, the leader is a stake pool.</p>
<a class="header" href="#transaction" id="transaction"><h2>Transaction</h2></a>
<p>Transaction forms the cornerstone of the blockchain, and is one type of fragment
and also the most frequent one.</p>
<p>Transaction is composed of inputs and outputs; On one side, the inputs represent
coins being spent, and on the other side the outputs represent coins being received.</p>
<pre><code>    Inputs         Alice (80$)        Bob (20$)
                        \             /
                         \           /
                          -----------
                                120$
                             --------- 
                            /         \
    Outputs            Charlie (50$)  Dan (50$)
</code></pre>
<p>Transaction have fees that are defined by the blockchain settings and the following invariant hold:</p>
<p>\[ \sum Inputs = \sum Outputs + fees \]</p>
<p>Transaction need to be authorized by each of the inputs in the transaction by their respective witness.
In the most basic case, a witness is a cryptographic signature, but depending on the type of input can
the type of witness vary.</p>
<a class="header" href="#accounting" id="accounting"><h2>Accounting</h2></a>
<p>The blockchain has two methods of accounting which are interoperable:</p>
<ul>
<li>Unspent Transaction Output (UTXO)</li>
<li>Accounts</li>
</ul>
<p>UTXO behaves like cash/notes, and work like fixed denomination ticket that are
cumulated. This is the accounting model found in Bitcoin. A UTXO is uniquely
reference by its transaction ID and its index.</p>
<p>Accounts behaves like a bank account, and are simpler to use since exact amount
can be used. This is the accounting model found in Ethereum. An account is
uniquely identified by its public key.</p>
<p>Each inputs could refer arbitrarily to an account or a UTXO, and similarly
each outputs could refer to an account or represent a new UTXO.</p>
<a class="header" href="#stake" id="stake"><h1>Stake</h1></a>
<p>In a proof of stake, participants are issued a stake equivalent to the amount
of coins they own. The stake is then used to allow participation in the protocol,
simply explained as:</p>
<blockquote>
<p>The more stake one has, the more likely one will participate in the good health of the network.</p>
</blockquote>
<p>When using the BFT consensus, the stake doesn't influence how the system
runs, but stake can still be manipulated for a later transition of the chain
to another consensus mode.</p>
<a class="header" href="#stake-in-the-account-model" id="stake-in-the-account-model"><h2>Stake in the Account Model</h2></a>
<p>Account are represented by 1 type of address and are just composed of a public key.
The account accumulate moneys and its stake power is directly represented by the amount it contains</p>
<p>For example:</p>
<pre><code>
    A - Account with 30$ =&gt; Account A has stake of 30
    B - Account with 0$ =&gt; Account B has no stake

</code></pre>
<p>The account might have a bigger stake than what it actually contains, since it could
also have associated UTXOs, and this case is covered in the next section.</p>
<a class="header" href="#stake-in-the-utxo-model" id="stake-in-the-utxo-model"><h2>Stake in the UTXO Model</h2></a>
<p>UTXO are represented by two kind of addresses:</p>
<ul>
<li>single address: those type of address have no stake associated</li>
<li>group address: those types of address have an account associated which receive the stake power of the UTXOs value</li>
</ul>
<p>For example with the following utxos:</p>
<pre><code>    UTXO1 60$ (single address) =&gt; has stake of 0

    UTXO2 50$ (group address A) \
                                 -&gt;- A - Account with 10$ =&gt; Account A has stake of 100
    UTXO3 40$ (group address A) /

    UTXO4 20$ (group address B) --&gt;- B - Account with 5$ =&gt; Account B has stake of 25
</code></pre>
<a class="header" href="#stake-pool" id="stake-pool"><h2>Stake pool</h2></a>
<p>Stake pool are the trusted block creators in the genesis-praos system. A pool
is declared on the network explicitely by its owners and contains, metadata
and cryptographic material.</p>
<p>Stake pool has no stake power on their own, but participants in the network
delegate their stake to a pool for running the operation.</p>
<a class="header" href="#stake-delegation" id="stake-delegation"><h2>Stake Delegation</h2></a>
<p>Stake can and need to be delegated to stake pool in the system. They can
change over time with a publication of a new delegation certificate.</p>
<p>Delegation certificate are a simple declaration statement in the form of:</p>
<pre><code>    Account 'A' delegate to Stake Pool 'Z'
</code></pre>
<p>Effectively it assign the stake in the account and its associated UTXO stake
to the pool it delegates to until another delegation certificate is made.</p>
<a class="header" href="#node-organisation" id="node-organisation"><h1>Node organisation</h1></a>
<a class="header" href="#secure-enclave" id="secure-enclave"><h2>Secure Enclave</h2></a>
<p>The secure enclave is the component containing the secret cryptographic
material, and offering safe and secret high level interfaces to the rest of
the node.</p>
<a class="header" href="#network" id="network"><h2>Network</h2></a>
<p>The node's network is 3 components:</p>
<ul>
<li>Intercommunication API (GRPC)</li>
<li>Public client API (REST)</li>
<li>Control client API (REST)</li>
</ul>
<a class="header" href="#intercommunication-api-grpc" id="intercommunication-api-grpc"><h3>Intercommunication API (GRPC)</h3></a>
<p>This interface is a binary, efficient interface using the protobuf format and
GRPC standard. The protobuf files of types and interfaces are available in
the source code.</p>
<p>The interface is responsible to communicate with other node in the network:</p>
<ul>
<li>block sending and receiving</li>
<li>fragments (transaction, certificates) broadcast</li>
<li>peer2peer gossip</li>
</ul>
<a class="header" href="#public-api-rest" id="public-api-rest"><h3>Public API REST</h3></a>
<p>This interface is for simple queries for clients like:</p>
<ul>
<li>Wallet Client &amp; Middleware</li>
<li>Analytics &amp; Debugging tools</li>
<li>Explorer</li>
</ul>
<p>it's recommended for this interface to not be opened to the public.</p>
<p>TODO: Add a high level overview of what it does</p>
<a class="header" href="#control-api-rest" id="control-api-rest"><h3>Control API REST</h3></a>
<p>This interface is not finished, but is a restricted interface with ACL,
to be able to do maintenance tasks on the process:</p>
<ul>
<li>Shutdown</li>
<li>Load/Retire cryptographic material</li>
</ul>
<p>TODO: Detail the ACL/Security measure</p>
<a class="header" href="#quickstart" id="quickstart"><h1>Quickstart</h1></a>
<p>The rust node comes with tools and help in order to quickly start
a node and connect to the blockchain.</p>
<p>It is compatible with most platforms and it is pre-packaged for some
of them.</p>
<p>Here we will see how to install <code>jormungandr</code> and its helper <code>jcli</code>
and how to connect quickly to a given blockchain.</p>
<p>There are three posible ways you can start jormungandr.</p>
<a class="header" href="#as-a-passive-node-in-an-existing-network" id="as-a-passive-node-in-an-existing-network"><h2>As a passive node in an existing network</h2></a>
<p>As described <a href="quickstart/./node_types/01_passive_node.html">here</a>.</p>
<p>The passive Node is the most common type of Node on the network. It can be used to download the blocks and broadcast transactions to peers, but it
doesn't have cryptographic materials or any mean to create blocks.
This type of nodes are mostly used for wallets, explorers or relays.</p>
<a class="header" href="#as-a-node-generating-blocks-in-an-existing-network" id="as-a-node-generating-blocks-in-an-existing-network"><h2>As a node generating blocks in an existing network</h2></a>
<p>The network could be running either bft or genesis consensus. In the former case the node must have the private key of a registered as a slot leader, while for the latter the private keys of a registered stake pool are needed.</p>
<p>More information <a href="quickstart/./node_types/02_generating_blocks.html">here</a></p>
<a class="header" href="#creating-your-own-network" id="creating-your-own-network"><h2>Creating your own network</h2></a>
<p>This is similar to the previous case, but configuring a genesis file is needed. Consult the <a href="quickstart/../advanced/introduction.html">Advanced section</a> for more information on this procedure.</p>
<p>The software is bundled with 2 different command line software:</p>
<ol>
<li><strong>jormungandr</strong>: the node;</li>
<li><strong>jcli</strong>: Jormungandr Command Line Interface, the helpers and primitives to run and interact with the node.</li>
</ol>
<a class="header" href="#installation" id="installation"><h1>Installation</h1></a>
<a class="header" href="#from-a-release" id="from-a-release"><h2>From a release</h2></a>
<p>This is the recommended method. Releases are all available
<a href="https://github.com/input-output-hk/jormungandr/releases">here</a>.</p>
<a class="header" href="#from-source" id="from-source"><h2>From source</h2></a>
<p>Jormungandr's code source is available on
<a href="https://github.com/input-output-hk/jormungandr#how-to-install-from-sources">github</a>.
Follow the instructions to build the software from sources.</p>
<a class="header" href="#help-and-auto-completion" id="help-and-auto-completion"><h1>Help and auto completion</h1></a>
<p>All commands come with usage help with the option <code>--help</code> or <code>-h</code>.</p>
<p>For <code>jcli</code>, it is possible to generate the auto completion with:</p>
<pre><code>jcli auto-completion bash ${HOME}/.bash_completion.d
</code></pre>
<p>Supported shells are: bash, fish, zsh, powershell and elvish.</p>
<p><strong>Note:</strong>
Make sure <code>${HOME}/.bash_completion.d</code> directory previously exists on your HD.
In order to use auto completion you still need to:</p>
<pre><code>source ${HOME}/.bash_completion.d/jcli.bash
</code></pre>
<p>You can also put it in your <code>${HOME}/.bashrc</code>.</p>
<p>In order to start the node, you first need to gather the blockchain
information you need to connect to.</p>
<ol>
<li>the hash of the <strong>genesis block</strong> of the blockchain, this will be the source
of truth of the blockchain. It is 64 hexadecimal characters.</li>
<li>the <strong>trusted peers</strong> identifiers and access points.</li>
</ol>
<p>These information are essentials to start your node in a secure way.</p>
<p>The <strong>genesis block</strong> is the first block of the blockchain. It contains the
static parameters of the blockchain as well as the initial funds. Your node
will utilise the <strong>Hash</strong> to retrieve it from the other peers. It will also
allows the Node to verify the integrity of the downloaded <strong>genesis block</strong>.</p>
<p>The <strong>trusted peers</strong> are the nodes in the public network that your Node will
trust in order to initialise the Peer To Peer network.</p>
<a class="header" href="#the-node-configuration" id="the-node-configuration"><h1>The node configuration</h1></a>
<p>Your node configuration file may look like the following:</p>
<p><strong>Note</strong></p>
<p>This config shouldn't work as it is, the ip address and port for the trusted peer should be those of an already running node.
Also, the public_address ('u.x.v.t') should be a valid address (you can use an internal one, eg: 127.0.0.1).
Furthermore, you need to have permission to write in the path specified by the storage config.</p>
<pre><code class="language-yaml">storage: &quot;/mnt/cardano/storage&quot;

rest:
  listen: &quot;127.0.0.1:8443&quot;

peer_2_peer:
  trusted_peers:
    - id: 1
      address: &quot;/ip4/104.24.28.11/tcp/8299&quot;
  public_address: &quot;/ip4/u.v.x.y/tcp/8299&quot;
  topics_of_interests:
    messages: low
    blocks: normal
</code></pre>
<p>Description of the fields:</p>
<ul>
<li><code>storage</code>: (optional) Path to the storage. If omitted, the
blockchain is stored in memory only.</li>
<li><code>logger</code>: (optional) Logging configuration:
<ul>
<li><code>verbosity</code>: 0 - warning, 1 - info, 2 - debug, 3 and above - trace</li>
<li><code>format</code>: Log output format, <code>plain</code> or <code>json</code>.</li>
<li><code>output</code>: Log output destination. Possible values are:
<ul>
<li><code>stdout</code>: standard output</li>
<li><code>stderr</code>: standard error</li>
<li><code>syslog</code>: syslog (only available on Unix systems)</li>
<li><code>journald</code>: journald service (only available on Linux with systemd,
(if jormungandr is built with the <code>systemd</code> feature)</li>
<li><code>gelf</code>: Configuration fields for GELF (Graylog) network logging protocol
(if jormungandr is built with the <code>gelf</code> feature):
<ul>
<li><code>backend</code>: <em>hostname</em>:<em>port</em> of a GELF server</li>
<li><code>log_id</code>: identifier of the source of the log, for the <code>host</code> field
in the messages.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>rest</code>: (optional) Configuration of the REST endpoint.
<ul>
<li><code>listen</code>: <em>address</em>:<em>port</em> to listen for requests</li>
<li><code>pkcs12</code>: (optional) Certificate file</li>
</ul>
</li>
<li><code>peer_2_peer</code>: P2P network settings
<ul>
<li><code>trusted_peers</code>: (optional) the list of nodes to connect to in order to
bootstrap the P2P topology (and bootstrap our local blockchain);</li>
<li><code>public_id</code>: (optional) the public identifier sent to the other nodes
in the P2P network. If not set it will be randomly generated.</li>
<li><code>public_address</code>: <a href="https://github.com/multiformats/multiaddr">multiaddr</a> string specifying address of the
P2P service. This is the public address that will be distributed to other
peers of the network that may find interest in participating to the
blockchain dissemination with the node.</li>
<li><code>topics_of_interests</code>: The dissemination topics this node is interested to hear about:
<ul>
<li><code>messages</code>: Transactions and other ledger entries.
Typical setting for a non-mining node: <code>low</code>. For a stakepool: <code>high</code>;</li>
<li><code>blocks</code>: Notifications about new blocks.
Typical setting for a non-mining node: <code>normal</code>. For a stakepool: <code>high</code>;</li>
</ul>
</li>
</ul>
</li>
</ul>
<a class="header" href="#starting-the-node" id="starting-the-node"><h1>Starting the node</h1></a>
<pre><code>jormungandr --config config.yaml --genesis-block-hash 'abcdef987654321....'
</code></pre>
<p>The 'abcdef987654321....' part refers to the hash of the genesis, that should be given to you from one of the peers in the network you are connecting to.</p>
<p>In case you have the genesis file (for example, because you are creating the network) you can get this hash with jcli.</p>
<pre><code class="language-sh">cat block-0 | jcli genesis hash
</code></pre>
<p>or, in case you only have the yaml file</p>
<pre><code class="language-sh">cat genesis.yaml | jcli genesis encode | jcli genesis hash
</code></pre>
<p>It is possible to query the node via its REST Interface.</p>
<p>In the node configuration, you have set something like:</p>
<pre><code class="language-yaml"># ...

rest:
  listen: &quot;127.0.0.1:8443&quot;

#...
</code></pre>
<p>This is the REST endpoint to talk to the node, to query blocks or send transaction.</p>
<p>It is possible to query the node stats with the following end point:</p>
<pre><code>curl http://127.0.0.1:8443/api/v0/node/stats
</code></pre>
<p>The result may be:</p>
<pre><code class="language-json">{&quot;blockRecvCnt&quot;:120,&quot;txRecvCnt&quot;:92,&quot;uptime&quot;:245}
</code></pre>
<blockquote>
<p>THE REST API IS STILL UNDER DEVELOPMENT</p>
</blockquote>
<p>Please note that the end points and the results may change in the future.</p>
<a class="header" href="#how-to-start-a-node-as-a-leader-candidate" id="how-to-start-a-node-as-a-leader-candidate"><h1>How to start a node as a leader candidate</h1></a>
<a class="header" href="#gathering-data" id="gathering-data"><h2>Gathering data</h2></a>
<p>Like in the passive node case, two things are needed to connect to an existing network</p>
<ol>
<li>the hash of the <strong>genesis block</strong> of the blockchain, this will be the source
of truth of the blockchain. It is 64 hexadecimal characters.</li>
<li>the <strong>trusted peers</strong> identifiers and access points.</li>
</ol>
<p>The node configuration could be the same as that for <a href="quickstart/./01_passive_node.html">running a passive node</a>.</p>
<p>There are some differences depending if you are connecting to a network running a genesis or bft consensus protocol.</p>
<a class="header" href="#connecting-to-a-genesis-blockchain" id="connecting-to-a-genesis-blockchain"><h3>Connecting to a genesis blockchain</h3></a>
<a class="header" href="#registering-a-stake-pool" id="registering-a-stake-pool"><h4>Registering a stake pool</h4></a>
<p>In order to be able to generate blocks in an existing genesis network, a <a href="../../stake_pool/registering_stake_pool">registered stake pool</a> is needed.</p>
<a class="header" href="#creating-the-secrets-file" id="creating-the-secrets-file"><h4>Creating the secrets file</h4></a>
<p>Put the node id and private keys in a yaml file in the following way:</p>
<a class="header" href="#example" id="example"><h5>Example</h5></a>
<p>filename: <em>node_secret.yaml</em></p>
<pre><code class="language-yaml">genesis:
  sig_key: Content of stake_pool_kes.prv file
  vrf_key: Content of stake_pool_vrf.prv file
  node_id: Content of stake_pool.id file
</code></pre>
<a class="header" href="#starting-the-node-1" id="starting-the-node-1"><h4>Starting the node</h4></a>
<pre><code class="language-sh">jormungandr --genesis-block-hash asdf1234... --config config.yaml --secret node_secret.yaml
</code></pre>
<p><em>The 'asdf1234...' part should be the actual block0 hash of the network</em></p>
<a class="header" href="#connecting-to-a-bft-blockchain" id="connecting-to-a-bft-blockchain"><h3>Connecting to a BFT blockchain</h3></a>
<p>In order to generate blocks, the node should be registered as a slot leader in the network and started in the following way.</p>
<a class="header" href="#the-secret-file" id="the-secret-file"><h2>The secret file</h2></a>
<p>Put secret key in a yaml file, e.g. <code>node_secret.yaml</code> as follows:</p>
<pre><code class="language-yaml">bft:
 signing_key: ed25519_sk1kppercsk06k03yk4qgea....
</code></pre>
<p>where signing_key is a private key associated to the public id of a slot leader.</p>
<a class="header" href="#starting-the-node-2" id="starting-the-node-2"><h3>Starting the node</h3></a>
<pre><code class="language-sh">jormungandr --genesis-block asdf1234... --config node.config --secret node_secret.yaml
</code></pre>
<p><em>The 'asdf1234...' part should be the actual block0 hash of the network</em></p>
<p>This chapter covers the node documentation, necessary to have a working system. It covers
the network, logging and storage parameters.</p>
<p>The node configuration uses the <a href="https://en.wikipedia.org/wiki/YAML">YAML</a> format.</p>
<p>This is an example of a configuration file:</p>
<pre><code class="language-YAML">storage: &quot;/tmp/storage&quot;
logger:
  verbosity: 1
  format: json
peer_2_peer:
  trusted_peers:
    - id: 1
      address: &quot;/ip4/104.24.28.11/tcp/8299&quot;
    - id: 2
      address: &quot;/ip4/104.24.29.11/tcp/8299&quot;
  public_address: &quot;/ip4/127.0.0.1/tcp/8080&quot;
  topics_of_interests:
    messages: low
    blocks: normal
</code></pre>
<p>The following options are available in the logger section:</p>
<ul>
<li><code>verbosity</code>:
<ul>
<li>0: warning</li>
<li>1: info</li>
<li>2: debug</li>
<li>3 and above: trace</li>
</ul>
</li>
<li><code>format</code>: log output format - <code>plain</code> or <code>json</code>.</li>
<li><code>output</code>: log output - <code>stdout</code>, <code>stderr</code>, <code>syslog</code> (Unix only),
or <code>journald</code> (Linux with systemd only, must be enabled during compilation).</li>
</ul>
<p>There's 2 differents network interfaces which are covered by their respective section:</p>
<pre><code>rest:
   ...
peer_2_peer:
   ...
</code></pre>
<a class="header" href="#rest-interface-configuration" id="rest-interface-configuration"><h2>REST interface configuration</h2></a>
<ul>
<li><em>listen</em>: listen address</li>
<li><em>pkcs12</em>: certificate file (optional)</li>
</ul>
<a class="header" href="#p2p-configuration" id="p2p-configuration"><h2>P2P configuration</h2></a>
<ul>
<li><em>trusted_peers</em>: (optional) the list of nodes to connect to in order to
bootstrap the p2p topology (and bootstrap our local blockchain);</li>
<li><em>public_id</em>: (optional) the public identifier send to the other nodes in the
p2p network. If not set it will be randomly generated.</li>
<li><em>public_address</em>: the address to listen from and accept connection
from. This is the public address that will be distributed to other peers
of the network that may find interest into participating to the blockchain
dissemination with the node;</li>
<li><em>topics_of_interests</em>: the different topics we are interested to hear about:
<ul>
<li><em>messages</em>: notify other peers this node is interested about Transactions
typical setting for a non mining node: <code>&quot;low&quot;</code>. For a stakepool: <code>&quot;high&quot;</code>;</li>
<li><em>blocks</em>: notify other peers this node is interested about new Blocs.
typical settings for a non mining node: <code>&quot;normal&quot;</code>. For a stakepool: <code>&quot;high&quot;</code>;</li>
</ul>
</li>
</ul>
<a class="header" href="#jcli" id="jcli"><h1>jcli</h1></a>
<p>This is the node command line helper. It is mostly meant for developers and
stake pool operators. It allows offline operations:</p>
<ul>
<li>generating cryptographic materials for the wallets and stake pools;</li>
<li>creating addresses, transactions and certificates;</li>
<li>prepare a new blockchain</li>
</ul>
<p>and it allows simple interactions with the node:</p>
<ul>
<li>query stats;</li>
<li>send transactions and certificates;</li>
<li>get raw blocks and UTxOs.</li>
</ul>
<a class="header" href="#cryptographic-keys" id="cryptographic-keys"><h1>cryptographic keys</h1></a>
<p>There are multiple type of key for multiple use cases.</p>
<table><thead><tr><th align="center"> type </th><th align="left"> usage </th></tr></thead><tbody>
<tr><td align="center"><code>Ed25519</code> </td><td align="left"> Signing algorithm for Ed25519 algorithm </td></tr>
<tr><td align="center"><code>Ed25519Bip32</code></td><td align="left"> Related to the HDWallet, Ed25519 Extended with chain code for derivation derivation </td></tr>
<tr><td align="center"><code>Ed25519Extended</code></td><td align="left"> Related to <code>Ed25519Bip32</code> without the chain code </td></tr>
<tr><td align="center"><code>SumEd25519_12</code></td><td align="left"> For stake pool, necessary for the KES </td></tr>
<tr><td align="center"><code>Curve25519_2HashDH</code></td><td align="left"> For stake pool, necessary for the VRF </td></tr>
</tbody></table>
<p>There is a command line parameter to generate this keys:</p>
<pre><code>$ jcli key generate --type=Ed25519
ed25519_sk1cvac48ddf2rpk9na94nv2zqhj74j0j8a99q33gsqdvalkrz6ar9srnhvmt
</code></pre>
<p>and to extract the associated public key:</p>
<pre><code>$ echo ed25519_sk1cvac48ddf2rpk9na94nv2zqhj74j0j8a99q33gsqdvalkrz6ar9srnhvmt | jcli key to-public
ed25519_pk1z2ffur59cq7t806nc9y2g64wa60pg5m6e9cmrhxz9phppaxk5d4sn8nsqg
</code></pre>
<a class="header" href="#address" id="address"><h1>Address</h1></a>
<p>Jormungandr comes with a separate CLI to create and manipulate addresses.</p>
<p>This is useful for creating addresses from their components in the CLI,
for debugging addresses and for testing.</p>
<a class="header" href="#display-address-info" id="display-address-info"><h2>Display address info</h2></a>
<p>To display an address and verify it is in a valid format you can utilise:</p>
<pre><code>$ jcli address info ta1svy0mwwm7mdwcuj308aapjw6ra4c3e6cygd0f333nvtjzxg8ahdvxlswdf0
discrimination: testing
public key: ed25519e_pk1pr7mnklkmtk8y5tel0gvnksldwywwkpzrt6vvvvmzus3jpldmtpsx9rnmx
</code></pre>
<p>or for example:</p>
<pre><code>$ jcli address \
    info \
    ca1qsy0mwwm7mdwcuj308aapjw6ra4c3e6cygd0f333nvtjzxg8ahdvxz8ah8dldkhvwfghn77se8dp76uguavzyxh5cccek9epryr7mkkr8n7kgx
discrimination: production
public key: ed25519_pk1pr7mnklkmtk8y5tel0gvnksldwywwkpzrt6vvvvmzus3jpldmtpsx9rnmx
group key:  ed25519_pk1pr7mnklkmtk8y5tel0gvnksldwywwkpzrt6vvvvmzus3jpldmtpsx9rnmx
</code></pre>
<a class="header" href="#creating-an-address" id="creating-an-address"><h2>Creating an address</h2></a>
<p>Each command following allows to create addresses for production and testing
chains. For chains, where the discrimination is <code>testing</code>, you need to
use the <code>--testing</code> flag.</p>
<p>There's 3 types of addresses:</p>
<ul>
<li>Single address : A simple spending key. This doesn't have any stake in the system</li>
<li>Grouped address : A spending key attached to an account key. The stake is automatically</li>
<li>Account address : An account key. The account is its own stake</li>
</ul>
<a class="header" href="#address-for-utxo" id="address-for-utxo"><h3>Address for UTxO</h3></a>
<p>You can create a single address (non-staked) using the spending public key for
this address utilising the following command:</p>
<pre><code>$ jcli address \
    single ed25519e_pk1jnlhwdgzv3c9frknyv7twsv82su26qm30yfpdmvkzyjsdgw80mfqduaean
ca1qw207ae4qfj8q4yw6v3ned6psa2r3tgrw9u3y9hdjcgj2p4pcaldyukyka8
</code></pre>
<p>To add the staking information and make a group address, simply add the account
public key as a second parameter of the command:</p>
<pre><code>$ jcli address \
    single \
    ed25519_pk1fxvudq6j7mfxvgk986t5f3f258sdtw89v4n3kr0fm6mpe4apxl4q0vhp3k \
    ed25519_pk1as03wxmy2426ceh8nurplvjmauwpwlcz7ycwj7xtl9gmx9u5gkqscc5ylx
ca1q3yen35r2tmdye3zc5lfw3x992s7p4dcu4jkwxcda80tv8xh5ym74mqlzudkg42443nw08cxr7e9hmcuzals9ufsa9uvh723kvteg3vpvrcxcq
</code></pre>
<a class="header" href="#address-for-account" id="address-for-account"><h3>Address for Account</h3></a>
<p>To create an account address you need the account public key and run:</p>
<pre><code>$ jcli address \
    account ed25519_pk1c4yq3hflulynn8fef0hdq92579n3c49qxljasrl9dnuvcksk84gs9sqvc2
ca1qhz5szxa8lnujwva8997a5q42nckw8z55qm7tkq0u4k03nz6zc74ze780qe
</code></pre>
<a class="header" href="#transaction-1" id="transaction-1"><h1>transaction</h1></a>
<p>Tooling for offline transaction creation and signing.</p>
<pre><code>jcli transaction
</code></pre>
<p>Those familiar with <a href="http://github.com/input-output-hk/cardano-cli"><code>cardano-cli</code></a>
transaction builder will see resemblance in <code>jcli transaction</code>.</p>
<p>There is a couple of commands that can be used to:</p>
<ol>
<li>prepare a transaction:
<ul>
<li><code>new</code> create a new empty transaction;</li>
<li><code>add-input</code></li>
<li><code>add-account</code></li>
<li><code>add-output</code></li>
</ul>
</li>
<li><code>finalize</code> the transaction for signing:</li>
<li>create witnesses and add the witnesses:
<ul>
<li><code>make-witness</code></li>
<li><code>add-witness</code></li>
</ul>
</li>
<li><code>seal</code> the transaction, ready to send to the blockchain</li>
</ol>
<p>There are also functions to help decode and display the
content information of a transaction:</p>
<ul>
<li><code>info</code></li>
<li><code>id</code> to get the <strong>Transaction ID</strong> of the transaction</li>
<li><code>to-message</code> to get the hexadecimal encoded message, ready to send with <code>cli rest message</code></li>
</ul>
<a class="header" href="#examples" id="examples"><h1>Examples</h1></a>
<p>The following example focuses on using an utxo as input, the few differences when transfering from an account will be pointed out when necessary.
There is also a script <a href="https://github.com/input-output-hk/jormungandr/blob/master/scripts/send-transaction">here</a> to send a transaction from a faucet account to a specific address which could be used as a reference.</p>
<p>Let's use the following utxo as input and transfer 50 lovelaces to the destination address</p>
<a class="header" href="#input-utxo" id="input-utxo"><h2>Input utxo</h2></a>
<table><thead><tr><th> Field                     </th><th align="center"> Value        </th></tr></thead><tbody>
<tr><td> UTXO's transaction ID     </td><td align="center"> 55762218e5737603e6d27d36c8aacf8fcd16406e820361a8ac65c7dc663f6d1c</td></tr>
<tr><td> UTXO's output index       </td><td align="center"> 0     </td></tr>
<tr><td> associated address        </td><td align="center">  ca1q09u0nxmnfg7af8ycuygx57p5xgzmnmgtaeer9xun7hly6mlgt3pjyknplu    </td></tr>
<tr><td> associated value          </td><td align="center"> 100             </td></tr>
</tbody></table>
<a class="header" href="#destination-address" id="destination-address"><h2>Destination address</h2></a>
<p><strong>addressca1qvnr5pvt9e5p009strshxndrsx5etcentslp2rwj6csm8sfk24a2wlqtdj6</strong></p>
<a class="header" href="#create-a-staging-area" id="create-a-staging-area"><h2>Create a staging area</h2></a>
<pre><code class="language-sh">jcli transaction new &gt; tx
</code></pre>
<a class="header" href="#add-input" id="add-input"><h2>Add input</h2></a>
<p>For the input, we need to reference the uxto with the <strong>UTXO's transaction ID</strong> and <strong>UTXO'S output index</strong> fields and we need to specify how much coins are there with the <strong>associated value</strong> field.</p>
<a class="header" href="#example-1" id="example-1"><h3>Example</h3></a>
<pre><code class="language-sh">jcli transaction add-input  55762218e5737603e6d27d36c8aacf8fcd16406e820361a8ac65c7dc663f6d1c 0 100 --staging tx
</code></pre>
<a class="header" href="#account-input" id="account-input"><h3>Account input</h3></a>
<p>If the input is an account, the command is slightly different</p>
<pre><code class="language-sh">jcli transaction add-account account_address account_funds --staging tx
</code></pre>
<a class="header" href="#add-output" id="add-output"><h2>Add output</h2></a>
<p>For the output, we need the address we want to transfer to, and the amount.</p>
<pre><code class="language-sh">jcli transaction add-output  ca1qvnr5pvt9e5p009strshxndrsx5etcentslp2rwj6csm8sfk24a2wlqtdj650 --staging tx
</code></pre>
<a class="header" href="#add-fee-and-change-address" id="add-fee-and-change-address"><h2>Add fee and change address</h2></a>
<p>We want to get the change in the same address that we are sending from (the <em>associated address</em> of the utxo). We also specify how to compute the fees.
You can leave out the <code>--fee-constant 5 --fee-coefficient 2</code> part if those are both 0.</p>
<pre><code class="language-sh">jcli transaction finalize  ca1q09u0nxmnfg7af8ycuygx57p5xgzmnmgtaeer9xun7hly6mlgt3pjyknplu --fee-constant 5 --fee-coefficient 2 --staging tx
</code></pre>
<p>Now, if you run</p>
<pre><code class="language-sh">jcli transaction info --fee-constant 5 --fee-coefficient 2 --staging tx
</code></pre>
<p>You should see something like this</p>
<pre><code class="language-plaintext">Transaction `0df39a87d3f18a188b40ba8c203f85f37af665df229fb4821e477f6998864273' (finalizing)
  Input:   100
  Output:  89
  Fees:    11
  Balance: 0
 - 55762218e5737603e6d27d36c8aacf8fcd16406e820361a8ac65c7dc663f6d1c:0 100
 + ca1qvnr5pvt9e5p009strshxndrsx5etcentslp2rwj6csm8sfk24a2wlqtdj650 50
 + ca1q09u0nxmnfg7af8ycuygx57p5xgzmnmgtaeer9xun7hly6mlgt3pjyknplu 39
</code></pre>
<a class="header" href="#sign-the-transaction" id="sign-the-transaction"><h2>Sign the transaction</h2></a>
<a class="header" href="#make-witness" id="make-witness"><h3>Make witness</h3></a>
<p>For signing the transaction, you need the private key associated with the input address (the one that's in the utxos) and the hash of the genesis block of the network you are connected to.</p>
<p>The genesis' hash is needed for ensuring that the transaction cannot be re-used in another blockchain and for security concerns on offline transaction signing, as we are signing the transaction for the specific blockchain started by this block0 hash.</p>
<p>The following command takes the private key in the <em>key.prv</em> file and creates a witness in a file named <em>witness</em> in the current directory.</p>
<pre><code class="language-sh">jcli transaction make-witness --genesis-block-hash abcdef987654321... --type utxo txid witness key.prv
</code></pre>
<hr />
<a class="header" href="#account-input-1" id="account-input-1"><h4>Account input</h4></a>
<p>When using an account as input, the command takes <code>account</code> as the type and an additional parameter: <code>--account-spending-counter</code>, that should be increased every time the account is used as input.</p>
<p>e.g.</p>
<pre><code class="language-sh">jcli transaction make-witness --genesis-block-hash abcdef987654321... --type account --account-spending-counter 0 witness key.prv
</code></pre>
<a class="header" href="#add-witness" id="add-witness"><h3>Add witness</h3></a>
<pre><code class="language-sh">jcli transaction add-witness witness --staging tx
</code></pre>
<a class="header" href="#send-the-transaction" id="send-the-transaction"><h2>Send the transaction</h2></a>
<pre><code class="language-sh">jcli transaction seal --staging tx
</code></pre>
<pre><code class="language-sh">jcli transaction to-message --staging tx &gt; txmsg
</code></pre>
<p>Send it using the rest api</p>
<pre><code class="language-sh">jcli rest v0 message post -f txmsg --host http://127.0.0.1:8443/api
</code></pre>
<a class="header" href="#checking-if-the-transaction-was-accepted" id="checking-if-the-transaction-was-accepted"><h2>Checking if the transaction was accepted</h2></a>
<p>You can check if the transaction was accepted by checking the node logs, for example, if the transaction is accepted</p>
<p><code>jcli rest v0 message logs -h http://127.0.0.1:8443/api</code></p>
<pre><code class="language-plaintext">---
- fragment_id: d6ef0b2148a51ed64531efc17978a527fd2d2584da1e344a35ad12bf5460a7e2
  last_updated_at: &quot;2019-06-11T15:38:17.070162114Z&quot;
  received_at: &quot;2019-06-11T15:37:09.469101162Z&quot;
  received_from: Rest
  status:
    InABlock: &quot;4.707&quot;
</code></pre>
<p>Where the InABlock status means that the transaction was accepted in the block with date &quot;4.707&quot;.</p>
<p>The status here could also be:</p>
<p>Pending: if the transaction is received and is pending being added in the blockchain (or rejected).</p>
<p>or</p>
<p>Rejected: with an attached message of the reason the transaction was rejected.</p>
<a class="header" href="#certificate" id="certificate"><h1>certificate</h1></a>
<p>Tooling for offline transaction creation</p>
<a class="header" href="#builder" id="builder"><h2>Builder</h2></a>
<p>Builds a signed certificate.</p>
<p>The process can be split into steps on the first step certificate
is created.</p>
<pre><code>jcli certificate new stake-pool-registration \
  --vrf-key &lt;vrf-public-key&gt; --kes-key &lt;kes-public-key&gt; \
  [--owner &lt;owner-public-key&gt;] \
  --serial &lt;node-serial&gt; \
  &lt;output-file&gt;
</code></pre>
<p>if output-file is omited result will be written to stdout. Once
certificate is ready you must sign it with the private keys of
all the owners:</p>
<pre><code>jcli certificate sign &lt;key&gt; &lt;input-file&gt; &lt;output-file&gt;
</code></pre>
<a class="header" href="#genesis" id="genesis"><h1>Genesis</h1></a>
<p>Tooling for working with a genesis file</p>
<a class="header" href="#usage" id="usage"><h1>Usage</h1></a>
<pre><code class="language-sh">jcli genesis [subcommand]
</code></pre>
<a class="header" href="#subcommands" id="subcommands"><h2>Subcommands</h2></a>
<ul>
<li>decode: Print the YAML file corresponding to an encoded genesis block.</li>
<li>encode: Create the genesis block of the blockchain from a given yaml file.</li>
<li>hash: Print the block hash of the genesis</li>
<li>init: Create a default Genesis file with appropriate documentation to help creating the YAML file</li>
<li>help</li>
</ul>
<a class="header" href="#examples-1" id="examples-1"><h2>Examples</h2></a>
<a class="header" href="#encode-a-genesis-file" id="encode-a-genesis-file"><h3>Encode a genesis file</h3></a>
<pre><code class="language-sh">jcli genesis encode --input genesis.yaml --output block-0.bin
</code></pre>
<p>or equivantely</p>
<pre><code class="language-sh">cat genesis.yaml | jcli genesis encode &gt; block-0.bin
</code></pre>
<a class="header" href="#get-the-hash-of-an-encoded-genesis-file" id="get-the-hash-of-an-encoded-genesis-file"><h3>Get the hash of an encoded genesis file</h3></a>
<pre><code class="language-sh">jcli genesis hash --input block-0.bin
</code></pre>
<a class="header" href="#rest" id="rest"><h1>REST</h1></a>
<p>Jormungandr comes with a CLI client for manual communication with nodes over HTTP.</p>
<a class="header" href="#conventions" id="conventions"><h2>Conventions</h2></a>
<p>Many CLI commands have common arguments:</p>
<ul>
<li><code>-h &lt;addr&gt;</code> or <code>--host &lt;addr&gt;</code> - Node API address. Must always have <code>http://</code> or
<code>https://</code> prefix. E.g. <code>-h http://127.0.0.1</code>, <code>--host https://node.com:8443/cardano/api</code></li>
<li><code>--debug</code> - Print additional debug information to stderr.
The output format is intentionally undocumented and unstable</li>
<li><code>--output-format &lt;format&gt;</code> - Format of output data. Possible values: json, yaml, default yaml.
Any other value is treated as a custom format using values from output data structure.
Syntax is Go text template: https://golang.org/pkg/text/template/.</li>
</ul>
<a class="header" href="#node-stats" id="node-stats"><h2>Node stats</h2></a>
<p>Fetches node stats</p>
<pre><code>jcli rest v0 node stats get &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="#conventions">conventions</a></li>
<li>--debug - see <a href="#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
blockRecvCnt: 7 # Blocks received by node
txRecvCnt: 90   # Transactions received by node
uptime: 2101    # Node uptitme in seconds
</code></pre>
<a class="header" href="#whole-utxo" id="whole-utxo"><h2>Whole UTXO</h2></a>
<p>Fetches whole UTXO</p>
<pre><code>jcli rest v0 utxo get &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="#conventions">conventions</a></li>
<li>--debug - see <a href="#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
- in_idx: 0                                                                 # input index
  in_txid: 50f21ac6bd3f57f231c4bf9c5fff7c45e2529c4dffed68f92410dbf7647541f1 # input transaction hash in hex
  out_addr: ca1qvqsyqcyq5rqwzqfpg9scrgwpugpzysnzs23v9ccrydpk8qarc0jqxuzx4s  # output address in bech32
  out_value: 999999999                                                      # output value
</code></pre>
<a class="header" href="#post-transaction" id="post-transaction"><h2>Post transaction</h2></a>
<p>Posts a signed, hex-encoded transaction</p>
<pre><code>jcli rest v0 message post &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="#conventions">conventions</a></li>
<li>--debug - see <a href="#conventions">conventions</a></li>
<li>-f --file &lt;file_path&gt; - File containing hex-encoded transaction.
If not provided, transaction will be read from stdin.</li>
</ul>
<a class="header" href="#get-message-log" id="get-message-log"><h2>Get message log</h2></a>
<p>Get the node's logs on the message pool. This will provide information on pending transaction,
rejected transaction and or when a transaction has been added in a block</p>
<pre><code>jcli rest v0 message logs &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="#conventions">conventions</a></li>
<li>--debug - see <a href="#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
- fragment_id: 7db6f91f3c92c0aef7b3dd497e9ea275229d2ab4dba6a1b30ce6b32db9c9c3b2 # hex-encoded fragment ID
  last_updated_at: 	2019-06-02T16:20:26.201000000Z                              # RFC3339 timestamp of last fragment status change
  received_at: 2019-06-02T16:20:26.201000000Z                                   # RFC3339 timestamp of fragment receivement
  received_from: Network,                                                       # how fragment was received
  status: Pending,                                                              # fragment status
</code></pre>
<p><code>received_from</code> can be one of:</p>
<pre><code class="language-yaml">received_from: Rest     # fragment was received from node's REST API
</code></pre>
<pre><code class="language-yaml">received_from: Network  # fragment was received from the network
</code></pre>
<p><code>status</code> can be one of:</p>
<pre><code class="language-yaml">status: Pending                 # fragment is pending
</code></pre>
<pre><code class="language-yaml">status:
  Rejected:                     # fragment was rejected
    reason: reason of rejection # cause
</code></pre>
<pre><code class="language-yaml">status:                         # fragment was included in a block
  InABlock: &quot;6637.3&quot;            # block epoch and slot ID formed as &lt;epoch&gt;.&lt;slot_id&gt;
</code></pre>
<a class="header" href="#blockchain-tip" id="blockchain-tip"><h2>Blockchain tip</h2></a>
<p>Retrieves a hex-encoded ID of the blockchain tip</p>
<pre><code>jcli rest v0 tip get &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="#conventions">conventions</a></li>
<li>--debug - see <a href="#conventions">conventions</a></li>
</ul>
<a class="header" href="#get-block" id="get-block"><h2>Get block</h2></a>
<p>Retrieves a hex-encoded block with given ID</p>
<pre><code>jcli rest v0 block &lt;block_id&gt; get &lt;options&gt;
</code></pre>
<p>&lt;block_id&gt; - hex-encoded block ID</p>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="#conventions">conventions</a></li>
<li>--debug - see <a href="#conventions">conventions</a></li>
</ul>
<a class="header" href="#get-next-block-id" id="get-next-block-id"><h2>Get next block ID</h2></a>
<p>Retrieves a list of hex-encoded IDs of descendants of block with given ID.
Every list element is in separate line. The IDs are sorted from closest to farthest.</p>
<pre><code>jcli rest v0 block &lt;block_id&gt; next-id get &lt;options&gt;
</code></pre>
<p>&lt;block_id&gt; - hex-encoded block ID</p>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="#conventions">conventions</a></li>
<li>--debug - see <a href="#conventions">conventions</a></li>
<li>-c --count <count> - Maximum number of IDs, must be between 1 and 100, default 1</li>
</ul>
<a class="header" href="#get-account-state" id="get-account-state"><h2>Get account state</h2></a>
<p>Get account state</p>
<pre><code>jcli rest v0 account get &lt;account-id&gt; &lt;options&gt;
</code></pre>
<p>&lt;account-id&gt; - ID of an account, bech32-encoded</p>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="#conventions">conventions</a></li>
<li>--debug - see <a href="#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
counter: 1
delegation: c780f14f9782770014d8bcd514b1bc664653d15f73a7158254730c6e1aa9f356
value: 990
</code></pre>
<ul>
<li><code>value</code> is the current balance of the account;</li>
<li><code>counter</code> is the number of transactions performed using this account
this is useful to know when signing new transactions;</li>
<li><code>delegation</code> is the Stake Pool Identifier the account is delegating to.
it is possible this value is not set if there is no delegation certificate
sent associated to this account.</li>
</ul>
<a class="header" href="#staking-with-jormungandr" id="staking-with-jormungandr"><h1>Staking with jormungandr</h1></a>
<p>Here we will describe how to:</p>
<ul>
<li><em>delegate your stake to a stake pool</em> so that you can participate to the consensus
and maybe collect rewards for that;</li>
</ul>
<p>If you are a user of the blockchain then you will certainly not need to look
at the last section about <em>how to register a stake pool</em>.</p>
<a class="header" href="#delegating-your-stake" id="delegating-your-stake"><h1>Delegating your stake</h1></a>
<a class="header" href="#how-to-create-the-delegation-certificate" id="how-to-create-the-delegation-certificate"><h2>how to create the delegation certificate</h2></a>
<p>Stake is concentrated in accounts, and you will need your account key to
delegate its associated stake.</p>
<p>You will need your:</p>
<ul>
<li>account public key: a bech32 string of a public key</li>
<li>the Stake Pool ID: an hexadecimal string identifying the stake pool you want
to delegate your stake to.</li>
</ul>
<pre><code>$ jcli certificate new stake-delegation STAKE_POOL_ID ACCOUNT_PUBLIC_KEY &gt; stake_delegation.cert
</code></pre>
<a class="header" href="#how-to-sign-your-delegation-certificate" id="how-to-sign-your-delegation-certificate"><h2>how to sign your delegation certificate</h2></a>
<p>We need to make sure that the owner of the account is authorizing this
delegation to happens, and for that we need a cryptographic signature.</p>
<p>We will need the account secret key to create a signature</p>
<pre><code>$ cat stake_delegation.cert | jcli certificate sign account_key.prv | tee stake_delegation.cert
cert1q8rv4ccl54k99rtnm39...zr0
</code></pre>
<p>The output can now be added in the <code>transaction</code> and submitted to a node.</p>
<a class="header" href="#submitting-to-a-node" id="submitting-to-a-node"><h2>submitting to a node</h2></a>
<p>To <code>jcli transaction add-certificate</code> command can be used to add a certificate to a transaction in <em>finalized</em> state.</p>
<p>For example:</p>
<pre><code class="language-sh">
...

jcli transaction finalize CHANGE_ADDRESS --fee-constant 5 --fee-coefficient 2 --fee-certificate 2 --staging tx

jcli transaction add-certificate $(cat stake_delegation.cert) --staging tx

...

</code></pre>
<p>The <code>--fee-certificate</code> flag indicates the cost of adding a certificate, used for computing the fees, it can be omitted if it is zero.</p>
<p>See <a href="stake_pool/../jcli/transaction.html">here</a> for more documentation on transaction creation.</p>
<a class="header" href="#registering-stake-pool" id="registering-stake-pool"><h1>registering stake pool</h1></a>
<p>There are multiple components to be aware of when running a stake pool:</p>
<ul>
<li>your <code>NodeId</code>: it is the identifier within the blockchain protocol (wallet
will delegate to your stake pool via this <code>NodeId</code>);</li>
<li>your <a href="https://en.wikipedia.org/wiki/Verifiable_random_function"><strong>VRF</strong></a> key pairs: this is the cryptographic material we will use to participate
to the leader election;</li>
<li>your [<strong>KES</strong>] key pairs: this is the cryptographic material we will use to sign the
block with.</li>
</ul>
<p>So in order to start your stake pool you will need to generate these objects.</p>
<a class="header" href="#the-primitives" id="the-primitives"><h1>The primitives</h1></a>
<a class="header" href="#vrf-key-pair" id="vrf-key-pair"><h2>VRF key pair</h2></a>
<p>To generate your <a href="https://en.wikipedia.org/wiki/Verifiable_random_function"><strong>VRF</strong></a> Key pairs, we will utilise [<code>jcli</code>] as described
<a href="stake_pool/../jcli/key.html">here</a>:</p>
<pre><code>$ jcli key generate --type=Curve25519_2HashDH &gt; stake_pool_vrf.prv
</code></pre>
<p><code>stake_pool_vrf.prv</code> file now contains the VRF private key.</p>
<pre><code>$ cat stake_pool_vrf.prv | jcli key to-public &gt; stake_pool_vrf.pub
</code></pre>
<a class="header" href="#kes-key-pair" id="kes-key-pair"><h2>KES key pair</h2></a>
<p>Similar to above:</p>
<pre><code>$ jcli key generate --type=SumEd25519_12 &gt; stake_pool_kes.prv
</code></pre>
<p><code>stake_pool_kes.prv</code> now contains your KES private key</p>
<pre><code>$ cat stake_pool_kes.prv | jcli key to-public &gt; stake_pool_kes.pub
</code></pre>
<a class="header" href="#creating-your-stake-pool-certificate" id="creating-your-stake-pool-certificate"><h1>creating your stake pool certificate</h1></a>
<p>The certificate is what will be sent to the blockchain in order to register
yourself to the other participants of the blockchain that you are a stake
pool too.</p>
<pre><code>$ jcli certificate new stake-pool-registration \
    --kes-key $(cat stake_pool_kes.pub) \
    --vrf-key $(cat stake_pool_vrf.pub) \
    --serial 1010101010 &gt; stake_pool.cert
</code></pre>
<p>Now you need to sign this certificate with the owner key:</p>
<pre><code>$ cat stake_pool.cert | jcli certificate sign stake_key.prv | tee stake_pool.cert
cert1qsqqqqqqqqqqqqqqqqqqq0p5avfqp9tzusr26...cegxaz
</code></pre>
<p>And now you can retrieve your stake pool id (<code>NodeId</code>):</p>
<pre><code>$ cat stake_pool.cert | jcli certificate get-stake-pool-id | tee stake_pool.id
ea830e5d9647af89a5e9a4d4089e6e855891a533316adf4a42b7bf1372389b74
</code></pre>
<a class="header" href="#advanced" id="advanced"><h1>Advanced</h1></a>
<p>This section is meant for advanced users and developers of the node, or if
you to learn more about the node.</p>
<p>At the moment, it only covers details on how to create your own blockchain genesis
configuration, but in normal case, the blockchain configuration should be available
with the specific blockchain system.</p>
<a class="header" href="#genesis-file" id="genesis-file"><h1>genesis file</h1></a>
<p>The genesis file is the file that allows you to create a new blockchain
from block 0. It lays out the different parameter of your blockchain:
the initial utxo, the start time, the slot duration time, etc...</p>
<p>Example of a BFT genesis file with an initial address UTxO and an account UTxO.
More info regarding <a href="advanced/./02_starting_bft_blockchain.html">starting a BFT blockchain here</a>
and <a href="advanced/../jcli/address.html">regarding addresses there</a>.
You could also find information regarding the <a href="advanced/../jcli/genesis.html">jcli genesis tooling</a>.</p>
<p>You can generate a documented pre-generated genesis file:</p>
<pre><code>jcli genesis init
</code></pre>
<p>For example your genesis file may look like:</p>
<pre><code class="language-yaml"># The Blockchain Configuration defines the settings of the blockchain.
blockchain_configuration:

  # The block0-date defines the date the blockchain starts
  # expected value in seconds since UNIX_EPOCH
  #
  # By default the value will be the current date and time. Or you can
  # add a specific time by entering the number of seconds since UNIX
  # Epoch
  block0_date: {default_block0_date}

  # This is the type of discrimination of the blockchain
  # of this blockchain is meant for production then
  # use 'production' instead.
  #
  # otherwise leave as this
  discrimination: {discrimination}

  # The initial consensus version:
  #
  # * BFT consensus: bft
  # * Genesis Praos consensus: genesis
  block0_consensus: bft

  # Number of slots in each epoch.
  #
  # default value is {default_slots_per_epoch}
  slots_per_epoch: {default_slots_per_epoch}

  # The slot duration, in seconds, is the time between the creation
  # of 2 blocks
  #
  # default value is {default_slot_duration}
  slot_duration: {default_slot_duration}

  # A list of Ed25519 PublicKey that represents the
  # BFT leaders encoded as bech32. The order in the list matters.
  consensus_leader_ids:
    - {leader_1}
    - {leader_2}

  # Genesis praos parameter D
  #
  # default value: {default_bft_slots_ratio}
  bft_slots_ratio: {default_bft_slots_ratio}

  # Genesis praos active slot coefficient
  # Determines minimum stake required to try becoming slot leader, must be in range (0,1]
  #
  # default value: {default_consensus_genesis_praos_active_slot_coeff}
  consensus_genesis_praos_active_slot_coeff: {default_consensus_genesis_praos_active_slot_coeff}

  # The fee calculations settings
  #
  # total fees: constant + (num_inputs + num_outputs) * coefficient [+ certificate]
  linear_fees:
    # this is the minimum value to pay for every transaction
    constant: 2
    # the additional fee to pay for every inputs and outputs
    coefficient: 1
    # the additional fee to pay if the transaction embeds a certificate
    certificate: 4

  # The speed to update the KES Key in seconds
  #
  # default value: {default_kes_update_speed}
  kes_update_speed: {default_kes_update_speed}

# Initial state of the ledger. Each item is applied in order of this list
initial:
  # Initial deposits present in the blockchain
  - fund:
      # UTxO addresses or account
      - address: {initial_funds_address}
        value: 10000

  # Initial certificate
  - cert: cert1qgqqqqqqqqqqqqqqqqqqq0p5avfqqmgurpe7s9k7933q0wj420jl5xqvx8lywcu5jcr7fwqa9qmdn93q4nm7c4fsay3mzeqgq3c0slnut9kns08yn2qn80famup7nvgtfuyszqzqrd4lxlt5ylplfu76p8f6ks0ggprzatp2c8rn6ev3hn9dgr38tzful4h0udlwa0536vyrrug7af9ujmrr869afs0yw9gj5x7z24l8sps3zzcmv

  # Initial deposits present in the blockchain
  #- legacy_fund:
  #    # Legacy Cardano address
  #    - address: 48mDfYyQn21iyEPzCfkATEHTwZBcZJqXhRJezmswfvc6Ne89u1axXsiazmgd7SwT8VbafbVnCvyXhBSMhSkPiCezMkqHC4dmxRahRC86SknFu6JF6hwSg8
  #      value: 123

</code></pre>
<p>There are multiple <em>parts</em> in the genesis file:</p>
<ul>
<li><code>blockchain_configuration</code>: this is a list of configuration
parameters of the blockchain, some of which can be changed later
via the update protocol;</li>
<li><code>initial</code>: list of steps to create initial state of ledger</li>
</ul>
<a class="header" href="#blockchain_configuration-options" id="blockchain_configuration-options"><h2><code>blockchain_configuration</code> options</h2></a>
<table><thead><tr><th align="left"> option </th><th align="left"> format </th><th align="left"> description </th></tr></thead><tbody>
<tr><td align="left"> <code>block0_date</code> </td><td align="left"> number </td><td align="left"> the official start time of the blockchain, in seconds since UNIX EPOCH </td></tr>
<tr><td align="left"> <code>discrimination</code> </td><td align="left"> string </td><td align="left"> <code>production</code> or <code>test</code> </td></tr>
<tr><td align="left"> <code>block0_consensus</code> </td><td align="left"> string </td><td align="left"> <code>bft</code> </td></tr>
<tr><td align="left"> <code>slot_duration</code> </td><td align="left"> number </td><td align="left"> the number of seconds between the creation of 2 blocks </td></tr>
<tr><td align="left"> <code>epoch_stability_depth</code> </td><td align="left"> number </td><td align="left"> allowed size of a fork (in number of block) </td></tr>
<tr><td align="left"> <code>consensus_leader_ids</code> </td><td align="left"> array </td><td align="left"> the list of the BFT leader at the beginning of the blockchain </td></tr>
<tr><td align="left"> <code>max_number_of_transactions_per_block</code> </td><td align="left"> number </td><td align="left"> the maximum number of transactions allowed in a block </td></tr>
<tr><td align="left"> <code>bft_slots_ratio</code> </td><td align="left"> number </td><td align="left"> placeholder, do not use </td></tr>
<tr><td align="left"> <code>linear_fees</code> </td><td align="left"> object </td><td align="left"> linear fee settings, set the fee for transaction and certificate publishing </td></tr>
<tr><td align="left"> <code>consensus_genesis_praos_active_slot_coeff</code> </td><td align="left"> number </td><td align="left"> genesis praos active slot coefficient.  Determines minimum stake required to try becoming slot leader, must be in range (0,1] </td></tr>
<tr><td align="left"> <code>kes_update_speed</code> </td><td align="left"> number </td><td align="left"> the speed to update the KES Key in seconds </td></tr>
<tr><td align="left"> <code>slots_per_epoch</code> </td><td align="left"> number </td><td align="left"> number of slots in each epoch </td></tr>
</tbody></table>
<p><em>for more information about the BFT leaders in the genesis file, see
<a href="advanced/./02_starting_bft_blockchain.html">Starting a BFT Blockchain</a></em></p>
<a class="header" href="#initial-options" id="initial-options"><h2><code>initial</code> options</h2></a>
<p>Each entry can be one of 3 variants:</p>
<table><thead><tr><th> variant </th><th> format </th><th> description </th></tr></thead><tbody>
<tr><td align="left"> <code>fund</code> </td><td align="left"> sequence </td><td align="left"> initial deposits present in the blockchain (up to 255 outputs per entry) </td></tr>
<tr><td align="left"> <code>cert</code> </td><td align="left"> string </td><td align="left"> initial certificate </td></tr>
<tr><td align="left"> <code>legacy_fund</code> </td><td align="left"> sequence </td><td align="left"> same as <code>fund</code>, but with legacy Cardano address format </td></tr>
</tbody></table>
<p>Example:</p>
<pre><code class="language-yaml">initial:
  - fund:
      - address: &lt;address&gt;
        value: 10000
      - address: &lt;address2&gt;
        value: 20000
      - address: &lt;address3&gt;
        value: 30000
  - cert: &lt;certificate&gt;
  - legacy_fund:
      - address: &lt;legacy address&gt;
        value: 123
  - fund:
      - address: &lt;another address&gt;
        value: 1001
</code></pre>
<a class="header" href="#fund-and-legacy_fund-format" id="fund-and-legacy_fund-format"><h3><code>fund</code> and <code>legacy_fund</code> format</h3></a>
<table><thead><tr><th> variant </th><th> format </th><th> description </th></tr></thead><tbody>
<tr><td align="left"> <code>address</code> </td><td align="left"> string </td><td align="left"> can be a <a href="advanced/../jcli/address.html#address-for-utxo">single address</a> or an <a href="advanced/../jcli/address.html#address-for-account">account address</a> </td></tr>
<tr><td align="left"> <code>value</code> </td><td align="left"> number </td><td align="left"> assigned value </td></tr>
</tbody></table>
<p><code>legacy_fund</code> differs only in address format, which is legacy Cardano</p>
<a class="header" href="#starting-a-bft-node" id="starting-a-bft-node"><h1>starting a bft node</h1></a>
<p>BFT stands for the Byzantine Fault Tolerant
(<a href="https://iohk.io/research/papers/#L5IHCV53">read the paper</a>).</p>
<p>Jormungandr allows you to start a BFT blockchain fairly easily. The main
downside is that it is centralized, only a handful of nodes will ever have
the right to create blocks.</p>
<a class="header" href="#how-does-it-work" id="how-does-it-work"><h2>How does it work</h2></a>
<p>It is fairly simple. A given number of Nodes (<code>N</code>) will generate
a key pairs of type <code>Ed25519</code> (see
<a href="advanced/./../jcli/key.html">JCLI's Keys</a>).</p>
<p>They all share the public key and add them in the genesis.yaml file.
It is the source of truth, the file that will generate the first block
of the blockchain: the <strong>Block 0</strong>.</p>
<p>Then, only by one after the other, each Node will be allowed to create a block.
Utilising a Round Robin algorithm.</p>
<a class="header" href="#example-of-genesis-file" id="example-of-genesis-file"><h2>Example of genesis file</h2></a>
<pre><code class="language-yaml">blockchain_configuration:
  block0_date: 1550822014
  discrimination: test
  block0_consensus: bft
  slots_per_epoch: 5
  slot_duration: 15
  epoch_stability_depth: 10
  consensus_leader_ids:
    - ed25519e_pk1k3wjgdcdcn23k6dwr0cyh88ad7a4ayenyxaherfazwy363pyy8wqppn7j3
    - ed25519e_pk13talprd9grgaqzs42mkm0x2xek5wf9mdf0eefdy8a6dk5grka2gstrp3en
  bft_slots_ratio: 0.220
  consensus_genesis_praos_active_slot_coeff: 0.22
  max_number_of_transactions_per_block: 255
  linear_fees:
    constant: 2
    coefficient: 1
    certificate: 4
  kes_update_speed: 43200
initial:
  - fund:
      - address: ta1svy0mwwm7mdwcuj308aapjw6ra4c3e6cygd0f333nvtjzxg8ahdvxlswdf0
        value: 10000
  - cert: cert1qgqqqqqqqqqqqqqqqqqqq0p5avfqqmgurpe7s9k7933q0wj420jl5xqvx8lywcu5jcr7fwqa9qmdn93q4nm7c4fsay3mzeqgq3c0slnut9kns08yn2qn80famup7nvgtfuyszqzqrd4lxlt5ylplfu76p8f6ks0ggprzatp2c8rn6ev3hn9dgr38tzful4h0udlwa0536vyrrug7af9ujmrr869afs0yw9gj5x7z24l8sps3zzcmv
  - legacy_fund:
      - address: 48mDfYyQn21iyEPzCfkATEHTwZBcZJqXhRJezmswfvc6Ne89u1axXsiazmgd7SwT8VbafbVnCvyXhBSMhSkPiCezMkqHC4dmxRahRC86SknFu6JF6hwSg8
        value: 123
</code></pre>
<p>In order to start your blockchain in BFT mode you need to be sure that:</p>
<ul>
<li><code>consensus_leader_ids</code> is non empty;</li>
</ul>
<p>more information regarding the <a href="advanced/./01_the_genesis_block.html">genesis file here</a>.</p>
<a class="header" href="#creating-the-block-0" id="creating-the-block-0"><h2>Creating the block 0</h2></a>
<pre><code>jcli genesis encode --input genesis.yaml --output block-0.bin
</code></pre>
<p>This command will create (or replace) the <strong>Block 0</strong> of the blockchain
from the given genesis configuration file (<code>genesis.yaml</code>).</p>
<a class="header" href="#starting-the-node-3" id="starting-the-node-3"><h2>Starting the node</h2></a>
<p>Now that the blockchain is initialized, you need to start your node.</p>
<p>Write you private key in a file on your HD:</p>
<pre><code>$ cat node_secret.yaml
bft:
  signing_key: ed25519_sk1hpvne...
</code></pre>
<p>Configure your Node (config.yml) and run the following command:</p>
<pre><code>$ jormungandr --genesis-block block-0.bin \
    --config example.config \
    --secret node_secret.yaml
</code></pre>
<p>It's possible to use the flag <code>--secret</code> multiple times to run a node
with multiple leaders.</p>
<a class="header" href="#step-by-step-to-start-the-bft-node" id="step-by-step-to-start-the-bft-node"><h2>Step by step to start the BFT node</h2></a>
<ol>
<li>Generate initial config <code>jcli genesis init &gt; genesis.yaml</code></li>
<li>Generate secret key, e.g. <code>jcli key generate --type=Ed25519 &gt; key.prv</code></li>
<li>Put secret key in a file, e.g. <code>node_secret.yaml</code> as follows:</li>
</ol>
<pre><code class="language-yaml">bft:
 signing_key: ed25519_sk1kppercsk06k03yk4qgea....
</code></pre>
<ol start="4">
<li>Generate public key out of previously generated key <code>cat key.prv | jcli key to-public</code></li>
<li>Put generated public key as in <code>genesis.yaml</code> under <code>consensus_leader_ids:</code></li>
<li>Generate block = <code>jcli genesis encode --input genesis.yaml --output block-0.bin</code></li>
<li>Create config file and store it on your HD as <code>node.config</code> e.g. -&gt;</li>
</ol>
<pre><code class="language-yaml">---
logger:
 verbosity: 4
 format: json
rest:
 listen: &quot;127.0.0.1:8607&quot;
peer_2_peer:
 public_address: /ip4/127.0.0.1/tcp/8606
 topics_of_interests:
 messages: low
 blocks: normal
</code></pre>
<ol start="8">
<li>Start Jörmungandr node :</li>
</ol>
<pre><code>jormungandr --genesis-block block-0.bin --config node.config --secret node_secret.yaml
</code></pre>
<a class="header" href="#script" id="script"><h1>Script</h1></a>
<p>Additionally, there is a script <a href="https://github.com/input-output-hk/jormungandr/blob/master/scripts/bootstrap">here</a> that can be used to bootstrap a test node with bft consensus protocol.</p>
<a class="header" href="#starting-a-genesis-blockchain" id="starting-a-genesis-blockchain"><h1>starting a genesis blockchain</h1></a>
<p>When starting a genesis praos blockchain there is an element to take
into consideration while constructing the block 0: <em>the stake distribution</em>.</p>
<p>In the context of Genesis/Praos the network is fully decentralized and it is
necessary to think ahead about initial stake pools and to make sure there
is stake delegated to these stake pools.</p>
<p>In your genesis yaml file, make sure to set the following values to the appropriate
values/desired values:</p>
<pre><code class="language-yaml"># The Blockchain Configuration defines the settings of the blockchain.
blockchain_configuration:
  block0_consensus: genesis
  bft_slots_ratio: 0
  consensus_genesis_praos_active_slot_coeff: 0.1
  kes_update_speed: 43200 # 12hours
</code></pre>
<p><code>block0_consensus</code> set to <code>genesis</code> means you want to start a blockchain with
genesis praos as the consensus layer.</p>
<p><code>bft_slots_ratio</code> needs to be set to <code>0</code> (we don't support composite modes between
BFT mode and Genesis mode -- yet).</p>
<p><code>consensus_genesis_praos_active_slot_coeff</code> determines minimum stake required to
try becoming slot leader, must be in range 0 exclusive and 1 inclusive.</p>
<a class="header" href="#the-initial-certificates" id="the-initial-certificates"><h2>The initial certificates</h2></a>
<p>In the <code>initial_certs</code> field you will set the initial certificate. This is important
to declare the stake pool and delegate stake to them. Otherwise no block will be ever
created.</p>
<p>Remember that in this array the <strong>order</strong> matters:</p>
<p>In order to delegate your stake, you need a stake pool to already exist, so the stake pool registration certificate should go first.</p>
<a class="header" href="#the-stake-key-declaration" id="the-stake-key-declaration"><h3>The stake key declaration</h3></a>
<p>To create a stake key simply follow the
<a href="advanced/../stake_pool/registering_stake.html">registering stake key guide</a>.</p>
<a class="header" href="#stake-pool-registration" id="stake-pool-registration"><h3>Stake pool registration</h3></a>
<p>Now you can register a stake pool.
Follow the instruction in <a href="advanced/../stake_pool/registering_stake_pool.html">registering stake pool guide</a>.</p>
<p>The <em>owner key</em> (the key you sign the stake pool registration certificate) is the secret
key associated to a previously registered stake key.</p>
<a class="header" href="#delegating-stake" id="delegating-stake"><h3>Delegating stake</h3></a>
<p>Now that there is both your stake key and there are stake pools available
in the block0 you need to delegate to one of the stake pool. Follow the instruction
in <a href="advanced/../stake_pool/delegating_stake.html">delegating stake</a>.</p>
<p>And in the initial funds start adding the addresses. To create an address with delegation
follow the instruction in <a href="advanced/../jcli/address.html">JCLI's address guide</a>. Utilise the stake key
registered previously as group address:</p>
<pre><code>jcli address single $(cat wallet_key.pub) $(cat stake_key.pub)
ta1sjx4j3jwel94g0cgwzq9au7h6m8f5q3qnyh0gfnryl3xan6qnmjse3k2uv062mzj34eacjnxthxqv8fvdcn6f4xhxwa7ms729ak3gsl4qrq2mm
</code></pre>
<p>You will notice that addresses with delegation are longer (about twice longer) than
address without delegation.</p>
<p>For example, the most minimal setting you may have is:</p>
<pre><code class="language-yaml">initial_certs:
  # register a stake pool (P), owner of the stake pool is the stake key (K)
  - cert1qsqqqqqqqqqqqqqqqqqqq0p5avfqp9tzusr26chayeddkkmdlap6tl23ceca8unsghc22tap8clhrzslkehdycufa4ywvqvs4u36zctw4ydtg7xagprfgz0vuujh3lgtxgfszqzqj4xk4sxxyg392p5nqz8s7ev5wna7eqz7ycsuas05mrupmdsfk0fqqudanew6c0nckf5tsp0lgnk8e8j0dpnxvjk2usn52vs8umr3qrccegxaz

  # delegate stake associated to stake key (K) to stake pool (P)
  - cert1q0rv4ccl54k99rtnm39xvhwvqcwjcm385n2dwvamahpu5tmdz3plt65rpewev3a03xj7nfx5pz0xap2cjxjnxvt2ma9y9dalzder3xm5qyqyq0lx05ggrws0ghuffqrg7scqzdsd665v4m7087eam5zvw4f26v2tsea3ujrxly243sgqkn42uttk5juvq78ajvfx9ttcmj05lfuwtq9qhdxzr0

initial_funds:
  # address without delegation
  - address: ta1swx4j3jwel94g0cgwzq9au7h6m8f5q3qnyh0gfnryl3xan6qnmjsczt057x
    value: 10000
  # address delegating to stake key (K)
  - address: ta1sjx4j3jwel94g0cgwzq9au7h6m8f5q3qnyh0gfnryl3xan6qnmjse3k2uv062mzj34eacjnxthxqv8fvdcn6f4xhxwa7ms729ak3gsl4qrq2mm
    value: 1000000
</code></pre>
<a class="header" href="#starting-the-node-4" id="starting-the-node-4"><h3>Starting the node</h3></a>
<p>Now, for starting the node and be able to generate new blocks, you have to put your pool's private keys and id in a file and start the node with the <code>--secret filename</code> parameter.</p>
<hr />
<p>For example, if you follow the examples of the <a href="advanced/../stake_pool/registering_stake_pool.html">registering stake pool guide</a></p>
<p>You could create a file called poolsecret.yaml with the following content.</p>
<pre><code class="language-yaml">genesis:
  sig_key: Content of stake_pool_kes.prv file
  vrf_key: Content of stake_pool_vrf.prv file
  node_id: Content of stake_pool.id file
</code></pre>
<p>And you could start the node with this command</p>
<pre><code class="language-sh">jormungandr --genesis-block block-0.bin --config config.yaml --secret poolsecret.yaml
</code></pre>
<a class="header" href="#test-script" id="test-script"><h1>Test script</h1></a>
<p>There is a script <a href="https://github.com/input-output-hk/jormungandr/blob/master/scripts/bootstrap">here</a> that can be used to bootstrap a test node with a pre-set faucet and stake pool and can be used as an example.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
        
        

    </body>
</html>
